{% extends "base.html" %}

{% block title %}Debug - Habit Tracker{% endblock %}

{% block content %}
<div class="mb-8 flex justify-between items-center">
    <h1 class="text-2xl font-bold">Debug View</h1>
    <button onclick="resetData()" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
        Reset All Data
    </button>
</div>

<div class="bg-white rounded-lg shadow-md p-6">
    <div class="mb-4">
        <h2 class="text-xl font-bold mb-2">Raw Data</h2>
        <pre class="bg-gray-100 p-4 rounded overflow-auto max-h-[600px]">{{ habits | tojson(indent=2) }}</pre>
    </div>

    <div class="mt-8">
        <h2 class="text-xl font-bold mb-4">Summary</h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-100 p-4 rounded">
                <p class="font-semibold">Total Habits</p>
                <p class="text-2xl">{{ habits | length }}</p>
            </div>
            <div class="bg-gray-100 p-4 rounded">
                <p class="font-semibold">Total Completions</p>
                <p class="text-2xl">{{ habits | map(attribute='completions') | map('length') | sum }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div id="resetModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <h3 class="text-lg font-medium text-gray-900">Confirm Reset</h3>
            <div class="mt-2">
                <p class="text-red-600">Warning: This will permanently delete all habits and their completion data.</p>
            </div>
            <div class="mt-4 flex justify-end">
                <button onclick="hideResetModal()" class="mr-2 px-4 py-2 text-gray-500 rounded hover:bg-gray-100">Cancel</button>
                <button onclick="confirmReset()" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-700">Reset</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function showResetModal() {
    document.getElementById('resetModal').classList.remove('hidden');
}

function hideResetModal() {
    document.getElementById('resetModal').classList.add('hidden');
}

function resetData() {
    showResetModal();
}

function confirmReset() {
    fetch('/reset_data', {
        method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    })
    .finally(() => {
        hideResetModal();
    });
}
</script>
{% endblock %} 